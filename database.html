---
layout: default
---

<main class="database">
  <div id="firebaseui-auth-container"></div>
  <div id="loader">Loading...</div>

 <form style="display:flex;flex-direction:column;" action="">
    <label for="url">Ссылка</label>
    <input id="url" class="url" type="text" required>
    <label for="description">Описание</label>
    <input id="description" class="title" type="text" required>
    <button class="submit-btn" style="margin-top:15px;">Отправить</button>
  </form>

  <p>Вывод данных:</p>
  <ul class="data-container"></ul>
</main>

<script src="https://www.gstatic.com/firebasejs/5.2.0/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.5.1/firebaseui.css" />
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDtjmXX8RViBFFeT3GgBO1rL86AeMfAsYo",
    authDomain: "mouseover-design.firebaseapp.com",
    databaseURL: "https://mouseover-design.firebaseio.com",
    projectId: "mouseover-design",
    storageBucket: "",
    messagingSenderId: "435474680440"
  };
  firebase.initializeApp(config);
</script>
<script>
  // Получаем референс корня базы
  var database = firebase.database();
  var inputUrl = document.querySelector('.url');
  var inputTitle = document.querySelector('.title');
  var submitButton = document.querySelector('.submit-btn');
  var removeButton = document.querySelectorAll('.remove-btn');
  var container = document.querySelector('.data-container');

  // Описываем как происходит запись
  // данных из формы в базу в раздел /accessibility
  function sendDataToFirebase(inputUrl, inputTitle) {
    database.ref('accessibility/').push({
      url: inputUrl,
      title: inputTitle
    });
  }

  // Рендерим добавленные данные на странице
  var dataRef = firebase.database().ref('accessibility/');
  dataRef.on('child_added', function(snapshot) {
    var item = snapshot.val();
    var key = snapshot.key;
    document.querySelector('.data-container').innerHTML += `<li data-key="${key}" class="data"><a href="${item.url}">${item.title}</a><button class="remove-btn" data-key="${key}">Удалить</button></li>`;
  });

  // Проверяем на пустые поля и отправляем данные в базу
  // по нажатию кнопки
  submitButton.addEventListener('click', function(e) {
    if (inputUrl.value !== '' && inputTitle.value !== '') {
      sendDataToFirebase(inputUrl.value, inputTitle.value);
//       inputUrl.value = '';
//       inputTitle.value = '';
    	document.querySelector('form').reset();
    } else {
      console.log('Заполните поля');
    }
  });

  // Удаление данных
  function removeData(key) {
    var data = database.ref('accessibility/' + key);

    data.remove()
    .then(function() {
    console.log("Remove succeeded.");
    })
    .catch(function(error) {
    console.log("Remove failed: " + error.message);
    });
  }

//   dataRef.on('child_removed', function(key) {
//     document.querySelector(`[data-key="${key}"]`).remove();
//   });

  // Удаляем по нажатию на кнопку
  document.addEventListener('click', function(e) {
    if (e.target.className === 'remove-btn') {
      var key = e.target.dataset.key;
      removeData(key);
      document.querySelector(`li[data-key="${key}"]`).remove();
    }
  });

  // Аутентификация
  var ui = new firebaseui.auth.AuthUI(firebase.auth());
  var uiConfig = {
  callbacks: {
    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
      // User successfully signed in.
      // Return type determines whether we continue the redirect automatically
      // or whether we leave that to developer to handle.
      return true;
    },
    uiShown: function() {
      // The widget is rendered.
      // Hide the loader.
      document.getElementById('loader').style.display = 'none';
    }
  },
    // Will use popup for IDP Providers sign-in flow instead of the default, redirect.
    signInFlow: 'popup',
    signInSuccessUrl: '/database.html',
    signInOptions: [
      // Leave the lines as is for the providers you want to offer your users.
      firebase.auth.GoogleAuthProvider.PROVIDER_ID
  ],
    // Terms of service url.
    tosUrl: '<your-tos-url>'
  };
 ui.start('#firebaseui-auth-container', uiConfig);
</script>
<!-- firebase.auth().signOut(); -->
